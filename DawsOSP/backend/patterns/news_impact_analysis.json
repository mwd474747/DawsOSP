{
  "id": "news_impact_analysis",
  "name": "News Impact Analysis",
  "description": "Portfolio-weighted news impact analysis with optional alerting",
  "version": "1.0.0",
  "category": "news",
  "tags": ["news", "sentiment", "impact", "alerts"],
  "author": "DawsOS",
  "created": "2025-10-23",
  "inputs": {
    "portfolio_id": {
      "type": "uuid",
      "required": true,
      "description": "Portfolio UUID"
    },
    "lookback_hours": {
      "type": "integer",
      "default": 24,
      "description": "News lookback period in hours (default 24)"
    },
    "min_impact_threshold": {
      "type": "number",
      "default": 0.05,
      "description": "Minimum impact score to include (0-1 scale)"
    },
    "create_alert": {
      "type": "boolean",
      "default": false,
      "description": "Create alert if high-impact news detected"
    }
  },
  "outputs": {
    "panels": [
      {
        "id": "impact_summary",
        "title": "Impact Summary",
        "type": "metrics_grid",
        "refresh_ttl": 300
      },
      {
        "id": "news_items",
        "title": "Relevant News",
        "type": "news_list",
        "refresh_ttl": 300
      },
      {
        "id": "entity_mentions",
        "title": "Entity Mentions",
        "type": "bar_chart",
        "refresh_ttl": 300
      }
    ]
  },
  "steps": [
    {
      "capability": "ledger.positions",
      "args": {
        "portfolio_id": "{{inputs.portfolio_id}}"
      },
      "as": "positions"
    },
    {
      "capability": "pricing.apply_pack",
      "args": {
        "positions": "{{state.positions}}",
        "pack_id": "{{ctx.pricing_pack_id}}"
      },
      "as": "valued"
    },
    {
      "capability": "news.search",
      "args": {
        "entities": "{{state.valued.symbols}}",
        "lookback_hours": "{{inputs.lookback_hours}}"
      },
      "as": "news_items"
    },
    {
      "capability": "news.compute_portfolio_impact",
      "args": {
        "news_items": "{{state.news_items}}",
        "positions": "{{state.valued}}",
        "min_threshold": "{{inputs.min_impact_threshold}}"
      },
      "as": "impact_analysis"
    },
    {
      "capability": "alerts.create_if_threshold",
      "args": {
        "impact_analysis": "{{state.impact_analysis}}",
        "threshold": 0.7,
        "alert_type": "news_impact"
      },
      "as": "alert_result",
      "condition": "{{inputs.create_alert}} == true"
    }
  ],
  "presentation": {
    "impact_summary": {
      "metrics": [
        {
          "label": "News Items Analyzed",
          "value": "{{impact_analysis.total_items}}",
          "format": "number"
        },
        {
          "label": "High-Impact Items",
          "value": "{{impact_analysis.high_impact_count}}",
          "format": "number"
        },
        {
          "label": "Weighted Impact Score",
          "value": "{{impact_analysis.weighted_impact}}",
          "format": "decimal_2",
          "color_condition": "sentiment"
        },
        {
          "label": "Portfolio Exposure",
          "value": "{{impact_analysis.exposed_portfolio_pct}}",
          "format": "percentage"
        },
        {
          "label": "Sentiment",
          "value": "{{impact_analysis.overall_sentiment}}",
          "format": "sentiment_badge"
        }
      ]
    },
    "news_items": {
      "items": "{{impact_analysis.news_with_impact}}",
      "item_template": {
        "title": "{{headline}}",
        "subtitle": "{{source}} â€¢ {{published_at}}",
        "impact_score": "{{impact_score}}",
        "sentiment": "{{sentiment}}",
        "entities": "{{entities}}",
        "portfolio_weight_affected": "{{weight_affected}}",
        "snippet": "{{summary}}"
      },
      "sort_by": "impact_score",
      "sort_order": "desc"
    },
    "entity_mentions": {
      "chart": {
        "type": "horizontal_bar",
        "title": "Entity Mentions (Top 10)",
        "x": "mention_count",
        "y": "entity",
        "data": "{{impact_analysis.entity_mentions}}",
        "color": "#00d9ff"
      }
    }
  },
  "rights_required": ["portfolio_read", "news_read"],
  "export_allowed": {
    "pdf": true,
    "csv": true
  },
  "observability": {
    "otel_span_name": "pattern.news_impact_analysis",
    "metrics": [
      "pattern_execution_duration_seconds",
      "news_fetch_duration_seconds",
      "news_items_processed_total"
    ]
  }
}
