{
  "pattern_id": "portfolio_overview",
  "name": "Portfolio Overview Dashboard",
  "description": "Comprehensive portfolio summary with performance, risk, and attribution metrics",
  "version": "2.0.0",
  "category": "portfolio",
  "tags": ["portfolio", "performance", "risk", "attribution"],
  "author": "DawsOS",
  "created": "2025-10-21",
  "inputs": {
    "portfolio_id": {
      "type": "uuid",
      "required": true,
      "description": "Portfolio UUID"
    },
    "lookback_days": {
      "type": "integer",
      "default": 252,
      "description": "Historical period in days (default 1 year)"
    },
    "benchmark": {
      "type": "string",
      "default": "SPY",
      "description": "Benchmark symbol (default S&P 500)"
    }
  },
  "outputs": {
    "panels": [
      {
        "id": "summary",
        "title": "Portfolio Summary",
        "type": "metrics_grid",
        "refresh_ttl": 300
      },
      {
        "id": "performance",
        "title": "Performance Analysis",
        "type": "chart_with_metrics",
        "refresh_ttl": 300
      },
      {
        "id": "risk",
        "title": "Risk Metrics",
        "type": "metrics_grid",
        "refresh_ttl": 300
      },
      {
        "id": "attribution",
        "title": "Return Attribution",
        "type": "breakdown_chart",
        "refresh_ttl": 300
      },
      {
        "id": "holdings",
        "title": "Top Holdings",
        "type": "table",
        "refresh_ttl": 60
      }
    ]
  },
  "steps": [
    {
      "capability": "get_portfolio_value",
      "args": {
        "portfolio_id": "{{inputs.portfolio_id}}",
        "pricing_pack_id": "{{ctx.pricing_pack_id}}"
      },
      "as": "current_value"
    },
    {
      "capability": "compute_twr",
      "args": {
        "portfolio_id": "{{inputs.portfolio_id}}",
        "pack_id": "{{ctx.pricing_pack_id}}",
        "lookback_days": "{{inputs.lookback_days}}"
      },
      "as": "twr"
    },
    {
      "capability": "compute_mwr",
      "args": {
        "portfolio_id": "{{inputs.portfolio_id}}",
        "pack_id": "{{ctx.pricing_pack_id}}"
      },
      "as": "mwr"
    },
    {
      "capability": "compute_max_drawdown",
      "args": {
        "portfolio_id": "{{inputs.portfolio_id}}",
        "pack_id": "{{ctx.pricing_pack_id}}",
        "lookback_days": "{{inputs.lookback_days}}"
      },
      "as": "drawdown"
    },
    {
      "capability": "compute_var",
      "args": {
        "portfolio_id": "{{inputs.portfolio_id}}",
        "pack_id": "{{ctx.pricing_pack_id}}",
        "confidence": 0.95,
        "lookback_days": "{{inputs.lookback_days}}",
        "method": "historical"
      },
      "as": "var"
    },
    {
      "capability": "compute_cvar",
      "args": {
        "portfolio_id": "{{inputs.portfolio_id}}",
        "pack_id": "{{ctx.pricing_pack_id}}",
        "confidence": 0.95,
        "lookback_days": "{{inputs.lookback_days}}"
      },
      "as": "cvar"
    },
    {
      "capability": "compute_tracking_error",
      "args": {
        "portfolio_id": "{{inputs.portfolio_id}}",
        "benchmark_id": "{{inputs.benchmark}}",
        "pack_id": "{{ctx.pricing_pack_id}}",
        "lookback_days": "{{inputs.lookback_days}}"
      },
      "as": "tracking"
    },
    {
      "capability": "compute_currency_attribution",
      "args": {
        "portfolio_id": "{{inputs.portfolio_id}}",
        "pack_id": "{{ctx.pricing_pack_id}}",
        "lookback_days": "{{inputs.lookback_days}}"
      },
      "as": "currency_attr"
    },
    {
      "capability": "compute_factor_exposure",
      "args": {
        "portfolio_id": "{{inputs.portfolio_id}}",
        "pack_id": "{{ctx.pricing_pack_id}}",
        "lookback_days": "{{inputs.lookback_days}}"
      },
      "as": "factors"
    },
    {
      "capability": "get_top_holdings",
      "args": {
        "portfolio_id": "{{inputs.portfolio_id}}",
        "pack_id": "{{ctx.pricing_pack_id}}",
        "limit": 10
      },
      "as": "holdings"
    }
  ],
  "presentation": {
    "summary": {
      "metrics": [
        {
          "label": "Portfolio Value",
          "value": "{{current_value.total_value}}",
          "format": "currency",
          "provenance": "pricing_pack:{{ctx.pricing_pack_id}}"
        },
        {
          "label": "1Y Return (TWR)",
          "value": "{{twr.twr}}",
          "format": "percentage",
          "provenance": "computed:twr:{{ctx.pricing_pack_id}}"
        },
        {
          "label": "1Y Return (MWR)",
          "value": "{{mwr.mwr}}",
          "format": "percentage",
          "provenance": "computed:mwr:{{ctx.pricing_pack_id}}"
        },
        {
          "label": "Volatility",
          "value": "{{twr.vol}}",
          "format": "percentage",
          "provenance": "computed:twr:{{ctx.pricing_pack_id}}"
        },
        {
          "label": "Sharpe Ratio",
          "value": "{{twr.sharpe}}",
          "format": "decimal_2",
          "provenance": "computed:twr:{{ctx.pricing_pack_id}}"
        },
        {
          "label": "Max Drawdown",
          "value": "{{drawdown.max_dd}}",
          "format": "percentage",
          "provenance": "computed:drawdown:{{ctx.pricing_pack_id}}"
        }
      ]
    },
    "performance": {
      "chart": {
        "type": "line",
        "x": "date",
        "y": "cumulative_return",
        "title": "Cumulative Return vs Benchmark",
        "series": [
          {
            "name": "Portfolio",
            "data": "{{twr.daily_returns}}",
            "color": "#00d9ff"
          },
          {
            "name": "Benchmark",
            "data": "{{tracking.benchmark_returns}}",
            "color": "#7f8c8d"
          }
        ]
      },
      "metrics": [
        {
          "label": "Excess Return",
          "value": "{{tracking.excess_return}}",
          "format": "percentage"
        },
        {
          "label": "Beta",
          "value": "{{tracking.beta}}",
          "format": "decimal_2"
        },
        {
          "label": "Correlation",
          "value": "{{tracking.correlation}}",
          "format": "decimal_2"
        }
      ]
    },
    "risk": {
      "metrics": [
        {
          "label": "1-Day VaR (95%)",
          "value": "{{var.var_1d}}",
          "format": "percentage",
          "color": "red"
        },
        {
          "label": "10-Day VaR (95%)",
          "value": "{{var.var_10d}}",
          "format": "percentage",
          "color": "red"
        },
        {
          "label": "CVaR (95%)",
          "value": "{{cvar.cvar_1d}}",
          "format": "percentage",
          "color": "red"
        },
        {
          "label": "Tracking Error",
          "value": "{{tracking.tracking_error}}",
          "format": "percentage"
        },
        {
          "label": "Information Ratio",
          "value": "{{tracking.information_ratio}}",
          "format": "decimal_2"
        }
      ]
    },
    "attribution": {
      "chart": {
        "type": "waterfall",
        "title": "Return Attribution",
        "categories": [
          "Local Return",
          "FX Return",
          "Interaction",
          "Total Return"
        ],
        "values": [
          "{{currency_attr.local_return}}",
          "{{currency_attr.fx_return}}",
          "{{currency_attr.interaction}}",
          "{{currency_attr.total_return}}"
        ]
      },
      "breakdown": {
        "title": "Currency Breakdown",
        "data": "{{currency_attr.by_currency}}"
      },
      "factors": {
        "title": "Factor Exposures",
        "data": "{{factors.beta}}"
      }
    },
    "holdings": {
      "columns": [
        {
          "field": "symbol",
          "header": "Symbol",
          "width": 100
        },
        {
          "field": "weight",
          "header": "Weight",
          "format": "percentage",
          "width": 100
        },
        {
          "field": "value",
          "header": "Value",
          "format": "currency",
          "width": 150
        },
        {
          "field": "return_1d",
          "header": "1D Return",
          "format": "percentage",
          "width": 100
        },
        {
          "field": "return_ytd",
          "header": "YTD Return",
          "format": "percentage",
          "width": 100
        }
      ],
      "data": "{{holdings}}"
    }
  },
  "rights_required": ["portfolio_read"],
  "export_allowed": {
    "pdf": true,
    "csv": true,
    "excel": true
  },
  "observability": {
    "otel_span_name": "pattern.portfolio_overview",
    "metrics": [
      "pattern_execution_duration_seconds",
      "pattern_steps_total",
      "pattern_capability_calls_total"
    ]
  }
}
