{
  "id": "cycle_deleveraging_scenarios",
  "name": "Cycle Deleveraging Scenarios",
  "description": "Apply family of deleveraging shocks (money printing, austerity, default) with hedge suggestions",
  "version": "1.0.0",
  "category": "risk",
  "tags": ["cycles", "deleveraging", "scenarios", "dalio", "hedge"],
  "author": "DawsOS",
  "created": "2025-10-23",
  "inputs": {
    "portfolio_id": {
      "type": "uuid",
      "required": true,
      "description": "Portfolio UUID"
    }
  },
  "outputs": {
    "panels": [
      {
        "id": "scenario_comparison",
        "title": "Deleveraging Scenario Comparison",
        "type": "comparison_table",
        "refresh_ttl": 0
      },
      {
        "id": "scenario_details",
        "title": "Scenario Impact Details",
        "type": "tabbed_content",
        "refresh_ttl": 0
      },
      {
        "id": "hedge_suggestions",
        "title": "Hedge Strategies",
        "type": "action_cards",
        "refresh_ttl": 0
      }
    ]
  },
  "steps": [
    {
      "capability": "ledger.positions",
      "args": {
        "portfolio_id": "{{inputs.portfolio_id}}"
      },
      "as": "positions"
    },
    {
      "capability": "pricing.apply_pack",
      "args": {
        "positions": "{{state.positions}}",
        "pack_id": "{{ctx.pricing_pack_id}}"
      },
      "as": "valued_base"
    },
    {
      "capability": "cycles.compute_long_term",
      "args": {},
      "as": "ltdc"
    },
    {
      "capability": "scenarios.deleveraging_money_printing",
      "args": {
        "portfolio_id": "{{inputs.portfolio_id}}",
        "pack_id": "{{ctx.pricing_pack_id}}"
      },
      "as": "money_printing"
    },
    {
      "capability": "scenarios.deleveraging_austerity",
      "args": {
        "portfolio_id": "{{inputs.portfolio_id}}",
        "pack_id": "{{ctx.pricing_pack_id}}"
      },
      "as": "austerity"
    },
    {
      "capability": "scenarios.deleveraging_default",
      "args": {
        "portfolio_id": "{{inputs.portfolio_id}}",
        "pack_id": "{{ctx.pricing_pack_id}}"
      },
      "as": "default"
    },
    {
      "capability": "optimizer.suggest_deleveraging_hedges",
      "args": {
        "portfolio_id": "{{inputs.portfolio_id}}",
        "scenarios": {
          "money_printing": "{{state.money_printing}}",
          "austerity": "{{state.austerity}}",
          "default": "{{state.default}}"
        }
      },
      "as": "hedge_suggestions"
    }
  ],
  "presentation": {
    "scenario_comparison": {
      "columns": [
        {"field": "metric", "header": "Metric", "width": 200},
        {"field": "base", "header": "Current", "format": "auto", "width": 120},
        {"field": "money_printing", "header": "Money Printing", "format": "auto", "width": 140, "color_condition": "sign"},
        {"field": "austerity", "header": "Austerity", "format": "auto", "width": 120, "color_condition": "sign"},
        {"field": "default", "header": "Default/Spreads", "format": "auto", "width": 140, "color_condition": "sign"}
      ],
      "data": [
        {
          "metric": "Portfolio Value",
          "base": "{{valued_base.total_value}}",
          "money_printing": "{{money_printing.portfolio_value}}",
          "austerity": "{{austerity.portfolio_value}}",
          "default": "{{default.portfolio_value}}"
        },
        {
          "metric": "Return Impact (%)",
          "base": "0.00%",
          "money_printing": "{{money_printing.return_delta}}",
          "austerity": "{{austerity.return_delta}}",
          "default": "{{default.return_delta}}"
        },
        {
          "metric": "P&L Impact ($)",
          "base": "$0",
          "money_printing": "{{money_printing.pnl_delta}}",
          "austerity": "{{austerity.pnl_delta}}",
          "default": "{{default.pnl_delta}}"
        },
        {
          "metric": "Real Rates Impact",
          "base": "-",
          "money_printing": "{{money_printing.real_rates_impact}}",
          "austerity": "{{austerity.real_rates_impact}}",
          "default": "{{default.real_rates_impact}}"
        },
        {
          "metric": "Credit Spread Impact",
          "base": "-",
          "money_printing": "{{money_printing.credit_spread_impact}}",
          "austerity": "{{austerity.credit_spread_impact}}",
          "default": "{{default.credit_spread_impact}}"
        },
        {
          "metric": "FX Impact",
          "base": "-",
          "money_printing": "{{money_printing.fx_impact}}",
          "austerity": "{{austerity.fx_impact}}",
          "default": "{{default.fx_impact}}"
        }
      ]
    },
    "scenario_details": {
      "tabs": [
        {
          "id": "money_printing",
          "label": "Money Printing (Inflationary)",
          "content": {
            "description": "{{money_printing.description}}",
            "shocks": "{{money_printing.shocks}}",
            "winners": "{{money_printing.winners}}",
            "losers": "{{money_printing.losers}}",
            "factor_breakdown": "{{money_printing.factor_breakdown}}"
          }
        },
        {
          "id": "austerity",
          "label": "Austerity (Deflationary)",
          "content": {
            "description": "{{austerity.description}}",
            "shocks": "{{austerity.shocks}}",
            "winners": "{{austerity.winners}}",
            "losers": "{{austerity.losers}}",
            "factor_breakdown": "{{austerity.factor_breakdown}}"
          }
        },
        {
          "id": "default",
          "label": "Default / Credit Crisis",
          "content": {
            "description": "{{default.description}}",
            "shocks": "{{default.shocks}}",
            "winners": "{{default.winners}}",
            "losers": "{{default.losers}}",
            "factor_breakdown": "{{default.factor_breakdown}}"
          }
        }
      ]
    },
    "hedge_suggestions": {
      "cards": "{{hedge_suggestions.suggestions}}",
      "card_template": {
        "title": "{{strategy_name}}",
        "subtitle": "Protection against {{scenario_type}}",
        "description": "{{description}}",
        "metrics": [
          {"label": "Instruments", "value": "{{instruments}}", "format": "text"},
          {"label": "Estimated Cost", "value": "{{cost_bps}}", "format": "bps"},
          {"label": "Hedge Effectiveness", "value": "{{effectiveness}}", "format": "percentage"},
          {"label": "Suggested Notional", "value": "{{notional}}", "format": "currency"}
        ],
        "payoff_chart": {
          "type": "line",
          "title": "Hedge Payoff Profile",
          "data": "{{payoff_profile}}"
        }
      }
    }
  },
  "rights_required": ["portfolio_read", "scenario_analysis"],
  "export_allowed": {
    "pdf": true,
    "csv": true
  },
  "observability": {
    "otel_span_name": "pattern.cycle_deleveraging_scenarios",
    "metrics": [
      "pattern_execution_duration_seconds",
      "scenario_computation_duration_seconds"
    ]
  }
}
