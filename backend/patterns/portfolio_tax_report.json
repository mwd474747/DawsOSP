{
  "metadata": {
    "name": "Portfolio Tax Report",
    "description": "Generate comprehensive tax reporting including realized gains, wash sales, and lot selection methods",
    "version": "1.0.0",
    "category": "tax_compliance",
    "output_format": "report"
  },
  "inputs": {
    "portfolio_id": {
      "type": "string",
      "required": true,
      "description": "Portfolio UUID"
    },
    "tax_year": {
      "type": "integer",
      "required": false,
      "default": 2025,
      "description": "Tax year for reporting"
    },
    "lot_selection_method": {
      "type": "string",
      "required": false,
      "default": "fifo",
      "enum": ["fifo", "lifo", "hifo", "specific"],
      "description": "Lot selection method for tax calculations"
    },
    "include_wash_sales": {
      "type": "boolean",
      "required": false,
      "default": true,
      "description": "Include wash sale analysis"
    }
  },
  "steps": [
    {
      "name": "get_realized_gains",
      "capability": "tax.realized_gains",
      "inputs": {
        "portfolio_id": "{{inputs.portfolio_id}}",
        "tax_year": "{{inputs.tax_year}}",
        "lot_method": "{{inputs.lot_selection_method}}"
      },
      "store_as": "realized_gains"
    },
    {
      "name": "analyze_wash_sales",
      "capability": "tax.wash_sales",
      "inputs": {
        "portfolio_id": "{{inputs.portfolio_id}}",
        "tax_year": "{{inputs.tax_year}}"
      },
      "store_as": "wash_sales",
      "condition": "{{inputs.include_wash_sales}}"
    },
    {
      "name": "get_tax_lots",
      "capability": "tax.lot_details",
      "inputs": {
        "portfolio_id": "{{inputs.portfolio_id}}"
      },
      "store_as": "tax_lots"
    },
    {
      "name": "calculate_summary",
      "capability": "tax.summary",
      "inputs": {
        "realized_gains": "{{realized_gains}}",
        "wash_sales": "{{wash_sales}}",
        "tax_year": "{{inputs.tax_year}}"
      },
      "store_as": "tax_summary"
    }
  ],
  "outputs": {
    "realized_gains": "{{realized_gains}}",
    "wash_sales": "{{wash_sales}}",
    "tax_lots": "{{tax_lots}}",
    "summary": "{{tax_summary}}"
  }
}