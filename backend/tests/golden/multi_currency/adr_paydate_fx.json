{
  "description": "ADR Pay-Date FX Golden Test - Validates 42¢ accuracy improvement",
  "scenario": "AAPL dividend paid to Canadian investor - demonstrates pay-date FX vs ex-date FX accuracy",
  "expected_accuracy_improvement": "0.42 CAD per transaction",
  "test_date": "2024-02-15",

  "position": {
    "ticker": "AAPL",
    "quantity": 100,
    "position_currency": "USD",
    "investor_currency": "CAD",
    "investor_account": "RRSP-CAD"
  },

  "dividend": {
    "ticker": "AAPL",
    "ex_dividend_date": "2024-02-09",
    "record_date": "2024-02-12",
    "pay_date": "2024-02-15",
    "cash_amount_usd": 0.24,
    "total_usd": 24.00,
    "currency": "USD"
  },

  "fx_rates": {
    "ex_date_fx": {
      "date": "2024-02-09",
      "pair": "USDCAD",
      "rate": 1.3500,
      "source": "FRED",
      "series_id": "DEXCAUS"
    },
    "pay_date_fx": {
      "date": "2024-02-15",
      "pair": "USDCAD",
      "rate": 1.3675,
      "source": "FRED",
      "series_id": "DEXCAUS"
    }
  },

  "calculations": {
    "wrong_method": {
      "description": "Using ex-date FX (WRONG - causes accuracy error)",
      "dividend_usd": 24.00,
      "fx_rate": 1.3500,
      "dividend_cad": 32.40,
      "error_type": "Overstates dividend by 42¢ CAD"
    },
    "correct_method": {
      "description": "Using pay-date FX (CORRECT - what investor actually receives)",
      "dividend_usd": 24.00,
      "fx_rate": 1.3675,
      "dividend_cad": 32.82,
      "accuracy": "Matches actual CAD deposit"
    },
    "accuracy_error": {
      "error_cad": 0.42,
      "error_bps": 128,
      "exceeds_tolerance": true,
      "tolerance_bps": 1,
      "critical": "YES - Exceeds ±1bp sacred accuracy threshold by 127bps"
    }
  },

  "ledger_entries": {
    "wrong_method_beancount": [
      "2024-02-15 * \"AAPL Dividend (WRONG - ex-date FX)\"",
      "  Assets:RRSP-CAD:Cash          32.40 CAD  ; WRONG AMOUNT",
      "  Income:Dividends:AAPL        -24.00 USD @ 1.3500 CAD"
    ],
    "correct_method_beancount": [
      "2024-02-15 * \"AAPL Dividend (CORRECT - pay-date FX)\"",
      "  Assets:RRSP-CAD:Cash          32.82 CAD  ; CORRECT AMOUNT",
      "  Income:Dividends:AAPL        -24.00 USD @ 1.3675 CAD"
    ]
  },

  "validation_checks": [
    {
      "check": "pay_date_field_exists",
      "description": "Polygon provider returns pay_date field",
      "requirement": "polygon_provider.get_dividends() must include pay_date",
      "acceptance_gate": "S1-W1"
    },
    {
      "check": "fx_rate_retrieval",
      "description": "FRED provider fetches FX rate for pay_date",
      "requirement": "fred_provider.get_series('DEXCAUS', pay_date, pay_date)",
      "acceptance_gate": "S1-W1"
    },
    {
      "check": "accuracy_validation",
      "description": "Reconciliation detects >1bp error with wrong FX",
      "requirement": "reconciliation.py detects 128bp error using ex-date FX",
      "acceptance_gate": "S1-W1"
    },
    {
      "check": "correct_fx_usage",
      "description": "System uses pay-date FX for ADR dividends",
      "requirement": "Jobs pipeline uses pay_date FX, not ex_date FX",
      "acceptance_gate": "S1-W1"
    }
  ],

  "acceptance_criteria": {
    "test_must_fail_with_ex_date_fx": true,
    "test_must_pass_with_pay_date_fx": true,
    "error_must_exceed_1bp_threshold": true,
    "reconciliation_must_catch_error": true
  },

  "references": {
    "spec": "PRODUCT_SPEC.md lines 520-540 (Multi-Currency Truth)",
    "polygon_provider": "backend/app/integrations/polygon_provider.py:80-120",
    "fred_provider": "backend/app/integrations/fred_provider.py:122-200",
    "reconciliation": "backend/jobs/reconciliation.py:140-180"
  }
}
