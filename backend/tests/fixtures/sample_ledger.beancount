; Sample Beancount Ledger for DawsOS Testing
; Purpose: Test ledger reconciliation with ±1bp accuracy
; Portfolio: Test Portfolio (11111111-1111-1111-1111-111111111111)
; Base Currency: CAD
; Updated: 2025-10-23

; ============================================================================
; Account Declarations
; ============================================================================

option "title" "DawsOS Test Portfolio"
option "operating_currency" "CAD"

; Portfolio accounts
2024-01-01 open Assets:Portfolio:11111111-1111-1111-1111-111111111111:Cash CAD
2024-01-01 open Assets:Portfolio:11111111-1111-1111-1111-111111111111:AAPL AAPL
2024-01-01 open Assets:Portfolio:11111111-1111-1111-1111-111111111111:MSFT MSFT
2024-01-01 open Assets:Portfolio:11111111-1111-1111-1111-111111111111:RY-CA RY.TO
2024-01-01 open Assets:Portfolio:11111111-1111-1111-1111-111111111111:TD-CA TD.TO

; Income accounts
2024-01-01 open Income:Dividends:AAPL USD
2024-01-01 open Income:Dividends:MSFT USD
2024-01-01 open Income:Dividends:RY-CA CAD
2024-01-01 open Income:Dividends:TD-CA CAD

; External accounts
2024-01-01 open Assets:Bank:Checking CAD
2024-01-01 open Expenses:Fees CAD
2024-01-01 open Equity:Opening-Balances

; ============================================================================
; Initial Capital
; ============================================================================

2024-01-01 * "Initial capital contribution"
  Assets:Portfolio:11111111-1111-1111-1111-111111111111:Cash    100000.00 CAD
  Equity:Opening-Balances                                      -100000.00 CAD

; ============================================================================
; Transaction 1: Buy AAPL (US stock, USD pricing)
; ============================================================================

2024-01-15 * "Buy 100 shares AAPL @ $150.00 USD"
  Assets:Portfolio:11111111-1111-1111-1111-111111111111:AAPL    100 AAPL {150.00 USD}
  Assets:Portfolio:11111111-1111-1111-1111-111111111111:Cash  -20100.00 CAD
    ; Trade FX rate: 1.34 USD/CAD
    ; Cost: 100 * 150.00 * 1.34 = 20,100 CAD
  Expenses:Fees                                                    0.00 CAD

; ============================================================================
; Transaction 2: Buy MSFT (US stock, USD pricing)
; ============================================================================

2024-02-01 * "Buy 50 shares MSFT @ $300.00 USD"
  Assets:Portfolio:11111111-1111-1111-1111-111111111111:MSFT     50 MSFT {300.00 USD}
  Assets:Portfolio:11111111-1111-1111-1111-111111111111:Cash  -20100.00 CAD
    ; Trade FX rate: 1.34 USD/CAD
    ; Cost: 50 * 300.00 * 1.34 = 20,100 CAD
  Expenses:Fees                                                    0.00 CAD

; ============================================================================
; Transaction 3: Buy RY.TO (Canadian stock, CAD pricing)
; ============================================================================

2024-02-15 * "Buy 100 shares RY.TO @ $120.00 CAD"
  Assets:Portfolio:11111111-1111-1111-1111-111111111111:RY-CA    100 RY.TO {120.00 CAD}
  Assets:Portfolio:11111111-1111-1111-1111-111111111111:Cash  -12000.00 CAD
  Expenses:Fees                                                    0.00 CAD

; ============================================================================
; Transaction 4: Buy TD.TO (Canadian stock, CAD pricing)
; ============================================================================

2024-03-01 * "Buy 80 shares TD.TO @ $75.00 CAD"
  Assets:Portfolio:11111111-1111-1111-1111-111111111111:TD-CA     80 TD.TO {75.00 CAD}
  Assets:Portfolio:11111111-1111-1111-1111-111111111111:Cash   -6000.00 CAD
  Expenses:Fees                                                    0.00 CAD

; ============================================================================
; Transaction 5: AAPL Dividend (ADR with pay-date FX)
; ============================================================================
; Critical test: Pay-date FX for ADR dividend accuracy
; Dividend: $0.24/share × 100 shares = $24.00 USD
; Ex-date FX: 1.34 USD/CAD (would give $32.16 CAD if used incorrectly)
; Pay-date FX: 1.36 USD/CAD (correct, gives $32.64 CAD)
; Accuracy impact: $0.48 CAD per transaction

2024-08-01 * "AAPL dividend - ex-date" #dividend
  ; Note: This is just the ex-date marker, not the actual payment

2024-08-15 * "AAPL dividend payment - 100 shares @ $0.24 USD" #dividend
  Income:Dividends:AAPL                                          -24.00 USD
  Assets:Portfolio:11111111-1111-1111-1111-111111111111:Cash     32.64 CAD
    ; Pay-date FX: 1.36 USD/CAD (CRITICAL: must use pay-date FX, not ex-date)
    ; Correct: 24.00 × 1.36 = 32.64 CAD
    ; Wrong if ex-date used: 24.00 × 1.34 = 32.16 CAD (error: -$0.48)
  pay_date: "2024-08-15"
  ex_date: "2024-08-01"
  pay_fx_rate: 1.36

; ============================================================================
; Transaction 6: MSFT Dividend
; ============================================================================

2024-08-20 * "MSFT dividend payment - 50 shares @ $0.68 USD" #dividend
  Income:Dividends:MSFT                                          -34.00 USD
  Assets:Portfolio:11111111-1111-1111-1111-111111111111:Cash     46.24 CAD
    ; Pay-date FX: 1.36 USD/CAD
    ; 34.00 × 1.36 = 46.24 CAD

; ============================================================================
; Transaction 7: RY.TO Dividend (Canadian stock, CAD)
; ============================================================================

2024-09-01 * "RY.TO dividend payment - 100 shares @ $1.20 CAD" #dividend
  Income:Dividends:RY-CA                                        -120.00 CAD
  Assets:Portfolio:11111111-1111-1111-1111-111111111111:Cash    120.00 CAD

; ============================================================================
; Transaction 8: TD.TO Dividend (Canadian stock, CAD)
; ============================================================================

2024-09-15 * "TD.TO dividend payment - 80 shares @ $0.96 CAD" #dividend
  Income:Dividends:TD-CA                                         -76.80 CAD
  Assets:Portfolio:11111111-1111-1111-1111-111111111111:Cash     76.80 CAD

; ============================================================================
; Transaction 9: Sell 50 shares AAPL
; ============================================================================

2024-10-01 * "Sell 50 shares AAPL @ $180.00 USD"
  Assets:Portfolio:11111111-1111-1111-1111-111111111111:AAPL    -50 AAPL {150.00 USD}
  Assets:Portfolio:11111111-1111-1111-1111-111111111111:Cash  12240.00 CAD
    ; Sell FX rate: 1.36 USD/CAD
    ; Proceeds: 50 * 180.00 * 1.36 = 12,240 CAD
    ; Cost basis: 50 * 150.00 * 1.34 = 10,050 CAD
    ; Capital gain: 2,190 CAD (realized)

; ============================================================================
; Transaction 10: Portfolio Fee
; ============================================================================

2024-10-15 * "Monthly portfolio management fee"
  Expenses:Fees                                                   50.00 CAD
  Assets:Portfolio:11111111-1111-1111-1111-111111111111:Cash    -50.00 CAD

; ============================================================================
; Balance Assertions (for validation)
; ============================================================================

; As of 2024-10-31, expected holdings:
; - Cash: 100,000 - 20,100 - 20,100 - 12,000 - 6,000 + 32.64 + 46.24 + 120.00 + 76.80 + 12,240 - 50 = 54,264.68 CAD
; - AAPL: 50 shares (100 bought, 50 sold)
; - MSFT: 50 shares
; - RY.TO: 100 shares
; - TD.TO: 80 shares

2024-10-31 balance Assets:Portfolio:11111111-1111-1111-1111-111111111111:Cash  54264.68 CAD
2024-10-31 balance Assets:Portfolio:11111111-1111-1111-1111-111111111111:AAPL      50 AAPL
2024-10-31 balance Assets:Portfolio:11111111-1111-1111-1111-111111111111:MSFT      50 MSFT
2024-10-31 balance Assets:Portfolio:11111111-1111-1111-1111-111111111111:RY-CA    100 RY.TO
2024-10-31 balance Assets:Portfolio:11111111-1111-1111-1111-111111111111:TD-CA     80 TD.TO

; ============================================================================
; NAV Calculation Reference (as of 2024-10-31)
; ============================================================================
; Using stub prices for reconciliation testing:
; - AAPL: $190.00 USD @ FX 1.36 = $258.40 CAD/share
; - MSFT: $350.00 USD @ FX 1.36 = $476.00 CAD/share
; - RY.TO: $130.00 CAD
; - TD.TO: $80.00 CAD
;
; Holdings Value:
;   Cash:     54,264.68 CAD
;   AAPL:     50 × 258.40 =  12,920.00 CAD
;   MSFT:     50 × 476.00 =  23,800.00 CAD
;   RY.TO:   100 × 130.00 =  13,000.00 CAD
;   TD.TO:    80 ×  80.00 =   6,400.00 CAD
;   ----------------------------------------
;   Total NAV:              110,384.68 CAD
;
; Reconciliation tolerance: ±1 basis point = ±$11.04 CAD
;
; ============================================================================
; Test Cases Covered
; ============================================================================
; 1. Multi-currency transactions (USD and CAD)
; 2. Pay-date FX for ADR dividends (AAPL, MSFT)
; 3. Canadian dividend income (RY.TO, TD.TO)
; 4. Capital gains from sales (AAPL partial sell)
; 5. Portfolio fees
; 6. Balance assertions for validation
; 7. NAV reconciliation within ±1bp tolerance
; ============================================================================
