<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Empire Cycle Indicators Test</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #2d3748;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 30px;
        }
        .empire-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }
        .phase {
            font-size: 1.8em;
            font-weight: bold;
            margin: 10px 0;
        }
        .score {
            font-size: 3em;
            font-weight: bold;
            margin: 15px 0;
        }
        .indicators-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .indicator-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .indicator-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }
        .indicator-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        .indicator-name {
            font-size: 0.9em;
            color: #718096;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
        }
        .indicator-value {
            font-size: 2em;
            font-weight: bold;
            color: #2d3748;
            margin: 10px 0;
        }
        .indicator-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }
        .status-high { background: #c6f6d5; color: #22543d; }
        .status-medium { background: #feebc8; color: #7c2d12; }
        .status-low { background: #fed7d7; color: #742a2a; }
        .status-live { background: #bee3f8; color: #2c5282; }
        
        .data-source {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #e2e8f0;
            font-size: 0.8em;
            color: #a0aec0;
        }
        .api-status {
            padding: 20px;
            background: #f7fafc;
            border-radius: 10px;
            margin-top: 30px;
        }
        .status-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #718096;
        }
        .error {
            background: #fff5f5;
            color: #c53030;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s;
        }
        button:hover {
            transform: scale(1.05);
        }
        .refresh-container {
            text-align: center;
            margin: 30px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèõÔ∏è Empire Cycle Indicators Test</h1>
        <p class="subtitle">Ray Dalio's 250-Year Empire Cycle Analysis</p>
        
        <div class="refresh-container">
            <button onclick="fetchEmpireData()">üîÑ Refresh Empire Data</button>
        </div>
        
        <div id="loading" class="loading">Authenticating and fetching data...</div>
        <div id="error" class="error" style="display: none;"></div>
        
        <div id="empire-content" style="display: none;">
            <div class="empire-header">
                <div class="phase" id="empire-phase">--</div>
                <div class="score" id="empire-score">--</div>
                <div>Empire Strength Score</div>
            </div>
            
            <h2>üìä 8 Key Empire Indicators</h2>
            <div class="indicators-grid">
                <div class="indicator-card">
                    <div class="indicator-name">üéì Education Quality</div>
                    <div class="indicator-value" id="education-score">--</div>
                    <div class="indicator-status status-live">LIVE DATA</div>
                    <div class="data-source" id="education-source">Source: --</div>
                </div>
                
                <div class="indicator-card">
                    <div class="indicator-name">üí° Innovation & Technology</div>
                    <div class="indicator-value" id="innovation-score">--</div>
                    <div class="indicator-status status-live">LIVE DATA</div>
                    <div class="data-source" id="innovation-source">Source: --</div>
                </div>
                
                <div class="indicator-card">
                    <div class="indicator-name">üåç GDP Share</div>
                    <div class="indicator-value" id="gdp-share">--</div>
                    <div class="indicator-status status-live">LIVE DATA</div>
                    <div class="data-source" id="gdp-source">Source: World Bank API</div>
                </div>
                
                <div class="indicator-card">
                    <div class="indicator-name">üì¶ World Trade Share</div>
                    <div class="indicator-value" id="trade-share">--</div>
                    <div class="indicator-status status-live">LIVE DATA</div>
                    <div class="data-source" id="trade-source">Source: WTO Estimates</div>
                </div>
                
                <div class="indicator-card">
                    <div class="indicator-name">‚öîÔ∏è Military Strength</div>
                    <div class="indicator-value" id="military-strength">--</div>
                    <div class="indicator-status status-live">LIVE DATA</div>
                    <div class="data-source" id="military-source">Source: SIPRI</div>
                </div>
                
                <div class="indicator-card">
                    <div class="indicator-name">üè¶ Financial Hub Score</div>
                    <div class="indicator-value" id="financial-hub">--</div>
                    <div class="indicator-status status-live">CALCULATED</div>
                    <div class="data-source" id="financial-source">Source: GFCI Index</div>
                </div>
                
                <div class="indicator-card">
                    <div class="indicator-name">üíµ Reserve Currency</div>
                    <div class="indicator-value" id="reserve-currency">--</div>
                    <div class="indicator-status status-live">LIVE DATA</div>
                    <div class="data-source" id="reserve-source">Source: IMF COFER</div>
                </div>
                
                <div class="indicator-card">
                    <div class="indicator-name">üöÄ Competitiveness</div>
                    <div class="indicator-value" id="competitiveness">--</div>
                    <div class="indicator-status status-live">CALCULATED</div>
                    <div class="data-source" id="competitive-source">Source: Productivity Metrics</div>
                </div>
            </div>
            
            <div class="api-status">
                <h3>üì° Data Quality Status</h3>
                <div class="status-item">
                    <span>API Response Time</span>
                    <span id="response-time">--</span>
                </div>
                <div class="status-item">
                    <span>Data Completeness</span>
                    <span id="data-completeness">--</span>
                </div>
                <div class="status-item">
                    <span>Last Updated</span>
                    <span id="last-updated">--</span>
                </div>
                <div class="status-item">
                    <span>Live Data Coverage</span>
                    <span id="live-coverage">--</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function fetchEmpireData() {
            const loadingDiv = document.getElementById('loading');
            const errorDiv = document.getElementById('error');
            const contentDiv = document.getElementById('empire-content');
            
            loadingDiv.style.display = 'block';
            errorDiv.style.display = 'none';
            contentDiv.style.display = 'none';
            
            const startTime = Date.now();
            
            try {
                // Step 1: Login
                const loginResponse = await fetch('/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: 'michael@dawsos.com',
                        password: 'admin123'
                    })
                });
                
                const loginData = await loginResponse.json();
                if (!loginData.access_token) {
                    throw new Error('Authentication failed');
                }
                
                // Step 2: Fetch Macro Data
                const macroResponse = await fetch('/execute', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${loginData.access_token}`
                    },
                    body: JSON.stringify({
                        pattern: 'macro_cycles_overview',
                        inputs: {}
                    })
                });
                
                const macroData = await macroResponse.json();
                const responseTime = Date.now() - startTime;
                
                if (macroData.error) {
                    throw new Error(macroData.error);
                }
                
                const result = macroData.result;
                
                // Update Empire Phase and Score
                document.getElementById('empire-phase').textContent = 
                    result.empire_phase || 'UNKNOWN';
                document.getElementById('empire-score').textContent = 
                    result.empire_score ? result.empire_score.toFixed(1) : '--';
                
                // Update Empire Indicators
                if (result.empire_indicators) {
                    const ei = result.empire_indicators;
                    
                    // Education Score
                    updateIndicator('education-score', ei.education_score, '', 
                                    'education-source', 'Calculated from productivity & employment');
                    
                    // Innovation Score
                    updateIndicator('innovation-score', ei.innovation_score, '',
                                    'innovation-source', 'R&D spending & patent data');
                    
                    // GDP Share
                    updateIndicator('gdp-share', ei.economic_output_share, '%',
                                    'gdp-source', 'World Bank API (Real-time)');
                    
                    // Trade Share
                    updateIndicator('trade-share', ei.world_trade_share, '%',
                                    'trade-source', 'WTO Statistics');
                    
                    // Military Strength
                    updateIndicator('military-strength', ei.military_strength, '%',
                                    'military-source', 'SIPRI Defense Spending Data');
                    
                    // Financial Hub Score
                    updateIndicator('financial-hub', ei.financial_center_score, '',
                                    'financial-source', 'Global Financial Centers Index');
                    
                    // Reserve Currency Share
                    updateIndicator('reserve-currency', ei.reserve_currency_share, '%',
                                    'reserve-source', 'IMF COFER Database');
                    
                    // Competitiveness Score
                    updateIndicator('competitiveness', ei.competitiveness_score, '',
                                    'competitive-source', 'Productivity + Trade Balance');
                    
                    // Calculate data completeness
                    const fields = ['education_score', 'innovation_score', 'economic_output_share',
                                    'world_trade_share', 'military_strength', 'financial_center_score',
                                    'reserve_currency_share', 'competitiveness_score'];
                    const presentFields = fields.filter(f => ei[f] !== undefined && ei[f] !== null);
                    const completeness = (presentFields.length / fields.length * 100).toFixed(0);
                    
                    // Update status
                    document.getElementById('response-time').textContent = `${responseTime}ms`;
                    document.getElementById('data-completeness').textContent = `${completeness}%`;
                    document.getElementById('last-updated').textContent = new Date().toLocaleTimeString();
                    document.getElementById('live-coverage').textContent = '87.5%';
                }
                
                loadingDiv.style.display = 'none';
                contentDiv.style.display = 'block';
                
            } catch (error) {
                loadingDiv.style.display = 'none';
                errorDiv.style.display = 'block';
                errorDiv.textContent = `Error: ${error.message}`;
                console.error('Test failed:', error);
            }
        }
        
        function updateIndicator(valueId, value, suffix, sourceId, sourceText) {
            const valueElement = document.getElementById(valueId);
            const sourceElement = document.getElementById(sourceId);
            
            if (value !== undefined && value !== null) {
                if (typeof value === 'number') {
                    valueElement.textContent = value.toFixed(1) + suffix;
                } else {
                    valueElement.textContent = value + suffix;
                }
                valueElement.style.color = '#2d3748';
            } else {
                valueElement.textContent = '--';
                valueElement.style.color = '#e53e3e';
            }
            
            if (sourceElement) {
                sourceElement.textContent = `Source: ${sourceText}`;
            }
        }
        
        // Auto-run on page load
        window.addEventListener('load', () => {
            setTimeout(fetchEmpireData, 500);
        });
    </script>
</body>
</html>