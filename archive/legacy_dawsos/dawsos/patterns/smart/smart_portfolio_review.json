{
  "id": "smart_portfolio_review",
  "name": "Smart Portfolio Review",
  "description": "Personalized portfolio health check that adapts analysis depth and focus based on risk profile and holdings",
  "category": "smart",
  "triggers": [
    "portfolio",
    "holdings",
    "review my portfolio",
    "check my portfolio",
    "portfolio health"
  ],
  "entities": [],
  "priority": 14,
  "steps": [
    {
      "description": "Fetch quotes for all holdings",
      "action": "execute_through_registry",
      "params": {
        "capability": "can_fetch_stock_quotes",
        "context": {
          "symbols": "{holdings}"
        }
      },
      "save_as": "portfolio_quotes"
    },
    {
      "description": "Calculate portfolio risk metrics",
      "action": "execute_through_registry",
      "params": {
        "capability": "can_calculate_risk_metrics",
        "context": {
          "holdings": "{holdings}",
          "risk_profile": "{risk_profile}"
        }
      },
      "save_as": "portfolio_risk"
    },
    {
      "description": "Analyze sector allocation",
      "action": "execute_through_registry",
      "params": {
        "capability": "can_map_relationships",
        "context": {
          "entities": "{holdings}",
          "relationship_type": "sector"
        }
      },
      "save_as": "sector_allocation"
    },
    {
      "description": "Generate personalized review based on risk profile and focus areas",
      "action": "execute_through_registry",
      "params": {
        "agent": "claude",
        "context": {
          "user_input": "Provide a {depth} portfolio review for a {risk_profile} investor. Holdings: {holdings}. Focus on: {focus_areas}. Portfolio quotes: {portfolio_quotes}. Risk metrics: {portfolio_risk}. Sector allocation: {sector_allocation}. Include specific recommendations.",
          "conversation_context": "{conversation_context}"
        }
      },
      "save_as": "review"
    }
  ],
  "response_type": "portfolio_analysis",
  "response_template": "{review}",
  "error_handling": "continue",
  "cache_ttl": 600,
  "version": "3.0",
  "last_updated": "2025-10-18",
  "template": "# Smart Portfolio Review\n\n## Portfolio Summary\n**Risk Profile**: {risk_profile}\n**Holdings**: {holdings}\n**Focus Areas**: {focus_areas}\n\n## Analysis Depth: {depth}\n\n{review.response}\n\n---\n*Personalized review powered by DawsOS Trinity 3.0*",
  "metadata": {
    "uses_entity_extraction": true,
    "supports_streaming": true,
    "memory_aware": true,
    "dynamic_routing": true
  }
}
