{
  "id": "legacy_migrator",
  "name": "Legacy Call Migrator",
  "description": "Detects and migrates legacy direct agent calls to proper Trinity execution path",
  "steps": [
    {
      "action": "detect_legacy_pattern",
      "params": {
        "request": "{request}",
        "indicators": [
          "direct_agent",
          "_direct",
          "bypass_pattern",
          "analyze",
          "harvest",
          "think"
        ]
      },
      "save_as": "legacy_type"
    },
    {
      "action": "extract_agent_info",
      "params": {
        "request": "{request}",
        "legacy_type": "{legacy_type}"
      },
      "save_as": "agent_info"
    },
    {
      "action": "convert_to_trinity",
      "params": {
        "agent_info": "{agent_info}",
        "original_request": "{request}"
      },
      "save_as": "trinity_request"
    },
    {
      "action": "log_migration",
      "params": {
        "from": "{legacy_type}",
        "to": "trinity_execution",
        "agent": "{agent_info.agent_name}",
        "method": "{agent_info.method}"
      }
    },
    {
      "action": "execute_pattern",
      "params": {
        "pattern": "execution_router",
        "context": "{trinity_request}"
      },
      "save_as": "result"
    },
    {
      "action": "track_legacy_usage",
      "params": {
        "caller": "{request.caller}",
        "agent": "{agent_info.agent_name}",
        "method": "{agent_info.method}"
      }
    }
  ],
  "response_template": {
    "result": "{result}",
    "migrated": true,
    "legacy_type": "{legacy_type}",
    "migration_note": "This call was automatically migrated from legacy direct execution to Trinity-compliant execution"
  }
}