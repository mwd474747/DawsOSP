{
  "id": "fundamental_analysis",
  "name": "Fundamental Analysis",
  "trigger_phrases": [
    "analyze fundamentals",
    "fundamental analysis",
    "company analysis",
    "stock fundamentals",
    "evaluate company",
    "analyze {symbol}",
    "value {symbol}"
  ],
  "description": "Perform comprehensive fundamental analysis using Buffett and Dalio frameworks",
  "category": "analysis",
  "priority": 90,
  "workflow": [
    {
      "step": "load_frameworks",
      "action": "knowledge_lookup",
      "parameters": {
        "knowledge_files": [
          "buffett_framework.json",
          "dalio_framework.json",
          "financial_calculations.json"
        ]
      }
    },
    {
      "step": "gather_financials",
      "action": "agent:data_harvester",
      "parameters": {
        "request": "Get financial data for {symbol}",
        "data_points": [
          "revenue",
          "earnings",
          "free_cash_flow",
          "debt",
          "equity",
          "margins"
        ]
      },
      "outputs": ["financial_data"]
    },
    {
      "step": "calculate_metrics",
      "action": "calculate",
      "parameters": {
        "formulas": {
          "owner_earnings": "Net Income + D&A - Maintenance CapEx",
          "roic": "NOPAT / Invested Capital",
          "fcf_yield": "FCF / Market Cap"
        }
      },
      "outputs": ["key_metrics"]
    },
    {
      "step": "assess_moat",
      "action": "agent:pattern_spotter",
      "parameters": {
        "request": "Evaluate economic moat for {symbol}",
        "framework": "buffett_moat_analysis"
      },
      "outputs": ["moat_assessment"]
    },
    {
      "step": "value_company",
      "action": "calculate",
      "parameters": {
        "method": "dcf_simplified",
        "inputs": "{financial_data}"
      },
      "outputs": ["intrinsic_value"]
    }
  ],
  "response": {
    "template": "📊 Fundamental Analysis: {symbol}\n\n🏰 **Economic Moat Assessment**\n{moat_assessment}\n\n💰 **Key Metrics**\n{key_metrics}\n\n📈 **Valuation**\n• Intrinsic Value: {intrinsic_value}\n• Current Price: {current_price}\n• Margin of Safety: {margin_of_safety}%\n\n🎯 **Investment Decision**\n{recommendation}",
    "format": "markdown"
  }
}