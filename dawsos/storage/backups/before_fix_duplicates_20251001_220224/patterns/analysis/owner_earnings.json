{
  "id": "owner_earnings",
  "name": "Owner Earnings Calculation",
  "trigger_phrases": [
    "owner earnings",
    "calculate owner earnings",
    "buffett earnings",
    "true earnings for {symbol}",
    "cash earnings"
  ],
  "description": "Calculate Buffett's owner earnings metric",
  "category": "analysis",
  "priority": 80,
  "workflow": [
    {
      "step": "load_formula",
      "action": "knowledge_lookup",
      "parameters": {
        "knowledge_file": "financial_calculations.json",
        "section": "buffett_calculations.owner_earnings"
      }
    },
    {
      "step": "gather_data",
      "action": "agent:data_harvester",
      "parameters": {
        "request": "Get financial data for {symbol}",
        "items": [
          "net_income",
          "depreciation_amortization",
          "capex",
          "working_capital_changes",
          "stock_compensation"
        ]
      },
      "outputs": ["financial_data"]
    },
    {
      "step": "calculate",
      "action": "calculate",
      "parameters": {
        "formula": "Net Income + D&A - Maintenance CapEx +/- Working Capital Changes",
        "inputs": "{financial_data}"
      },
      "outputs": ["owner_earnings", "calculation_steps"]
    },
    {
      "step": "quality_check",
      "action": "evaluate",
      "parameters": {
        "checks": [
          "owner_earnings > net_income",
          "owner_earnings_growth > revenue_growth",
          "consistent_positive_earnings"
        ]
      },
      "outputs": ["quality_assessment"]
    }
  ],
  "response": {
    "template": "ðŸ’° **Owner Earnings Analysis for {symbol}**\n\nðŸ“Š **Calculation**\n```\nNet Income:           ${net_income}M\n+ D&A:               ${depreciation}M\n- Maintenance CapEx:  ${maintenance_capex}M\n+/- Working Capital:  ${working_capital}M\n+ Stock Comp Adj:     ${stock_comp}M\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nOwner Earnings:       ${owner_earnings}M\n```\n\nðŸ“ˆ **Key Insights**\nâ€¢ Owner Earnings Yield: {owner_yield}%\nâ€¢ vs Net Income: {earnings_quality}\nâ€¢ 3-Year Growth: {growth_rate}%\n\nâœ… **Quality Assessment**\n{quality_assessment}\n\nðŸ’¡ **What This Means**\n{interpretation}",
    "format": "markdown"
  }
}