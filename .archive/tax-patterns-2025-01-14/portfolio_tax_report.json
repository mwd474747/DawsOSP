{
  "id": "portfolio_tax_report",
  "name": "Portfolio Tax Report",
  "description": "Generate comprehensive tax reporting including realized gains, wash sales, and lot selection methods",
  "version": "1.0.0",
  "category": "tax_compliance",
  "tags": ["tax", "compliance", "reporting"],
  "author": "DawsOS",
  "created": "2025-11-06",
  "inputs": {
    "portfolio_id": {
      "type": "string",
      "required": true,
      "description": "Portfolio UUID"
    },
    "tax_year": {
      "type": "integer",
      "required": false,
      "default": 2025,
      "description": "Tax year for reporting"
    },
    "lot_selection_method": {
      "type": "string",
      "required": false,
      "default": "fifo",
      "enum": ["fifo", "lifo", "hifo", "specific"],
      "description": "Lot selection method for tax calculations"
    },
    "include_wash_sales": {
      "type": "boolean",
      "required": false,
      "default": true,
      "description": "Include wash sale analysis"
    }
  },
  "outputs": ["realized_gains", "wash_sales", "tax_lots", "tax_summary"],
  "steps": [
    {
      "capability": "tax.realized_gains",
      "args": {
        "portfolio_id": "{{inputs.portfolio_id}}",
        "tax_year": "{{inputs.tax_year}}",
        "lot_method": "{{inputs.lot_selection_method}}"
      },
      "as": "realized_gains"
    },
    {
      "capability": "tax.wash_sales",
      "args": {
        "portfolio_id": "{{inputs.portfolio_id}}",
        "tax_year": "{{inputs.tax_year}}"
      },
      "as": "wash_sales"
    },
    {
      "capability": "tax.lot_details",
      "args": {
        "portfolio_id": "{{inputs.portfolio_id}}"
      },
      "as": "tax_lots"
    },
    {
      "capability": "tax.summary",
      "args": {
        "realized_gains": "{{realized_gains}}",
        "wash_sales": "{{wash_sales}}",
        "tax_year": "{{inputs.tax_year}}"
      },
      "as": "tax_summary"
    }
  ]
}